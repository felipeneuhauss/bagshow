// Generated by CoffeeScript 1.6.3
(function() {
  var PaymentsController,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  PaymentsController = (function(_super) {
    __extends(PaymentsController, _super);

    function PaymentsController($scope) {
      var idElement, listQuery;
      this.setScope($scope);
      listQuery = new Kinvey.Query;
      idElement = $('#paymentsForm').find('input[id="id"]').val();
      listQuery.equalTo('sale._id', idElement);
      this.scope.updatePayments = function() {
        var payment, _i, _len, _ref;
        _ref = $scope.payments;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          payment = _ref[_i];
          payment = unset('$$hashKey', payment);
          if (payment['paidAt'] !== "") {
            payment['paidAt'] = formatKinveyDate(payment['paidAt'], 'DD/MM/YYYY');
          }
          payment = convertArrayToJson(payment);
          Kinvey.DataStore.save('Payments', payment, {
            success: function(payment) {}
          });
        }
        return statusMessage('success', 'Pagamento(s) atualizado(s) com sucesso!');
      };
      PaymentsController.__super__.constructor.call(this, {
        scopeList: 'payments',
        collectionName: 'Payments',
        listQuery: listQuery,
        relationsList: {
          sale: 'Sales',
          customer: 'Customers'
        }
      });
    }

    PaymentsController.prototype.startEvents = function() {};

    return PaymentsController;

  })(AngularView);

  angularApp.controller('PaymentsController', PaymentsController);

}).call(this);
