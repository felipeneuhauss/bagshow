// Generated by CoffeeScript 1.6.3
var TourView, _ref,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

TourView = (function(_super) {
  __extends(TourView, _super);

  function TourView() {
    _ref = TourView.__super__.constructor.apply(this, arguments);
    return _ref;
  }

  TourView.prototype.loadModel = function() {
    var idElement;
    idElement = null;
    if (this.form) {
      idElement = this.form.find('input[name="id"]').val();
    }
    this.model = new Tour({
      successMessage: 'O tutorial da tela principal foi conclu√≠do',
      id: idElement,
      collectionName: 'Tours',
      view: this
    });
    return this;
  };

  TourView.prototype.startEvents = function() {
    var queryTour,
      _this = this;
    queryTour = new Kinvey.Query;
    queryTour.equalTo('tourName', this.options.tourName);
    return Kinvey.DataStore.find('Tours', queryTour, {
      success: function(result) {
        if (result.length === 0 || result[0].done === false) {
          return introJs().start().oncomplete(function() {
            return _this.model.save({
              tourName: _this.options.tourName,
              done: true,
              registeredAt: moment().format('YYYY-MM-DDTHH:mm:ss.SSSZ')
            });
          });
        }
      }
    });
  };

  TourView.prototype.resetForm = function() {};

  return TourView;

})(AbstractView);
